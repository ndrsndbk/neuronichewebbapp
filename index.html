<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neuro Niche ‚Äì Neurodiversity in Schools Fundamentals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --sage: #DDE6D5;
      --teal: #2E7D7C;
      --sand: #F3EEE6;
      --ink: #0F172A;
      --radius-xl: 18px;
      --radius-lg: 12px;
      --transition-fast: 0.25s ease;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 16px;                 /* ‚Üê base 16 to prevent iOS zoom */
      -webkit-text-size-adjust: 100%;  /* keep intended sizing on iOS */
      background-color: var(--sand);
      color: var(--ink);
      display: flex;
      justify-content: center;
    }
    .app-shell {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      padding: 16px 16px 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    header {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background-color: var(--sage);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .brand-title { font-weight: 600; font-size: 18px; }
    .brand-sub   { font-size: 12px; color: rgba(15,23,42,0.6); }

    .progress-wrap {
      margin-top: 4px;
      width: 100%;
      background: rgba(0,0,0,0.06);
      border-radius: 999px;
      height: 7px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: var(--teal);
      border-radius: 999px;
      transition: width var(--transition-fast);
    }
    .card {
      background-color: #ffffff;
      border-radius: var(--radius-xl);
      padding: 16px 14px 14px;
      box-shadow: 0 8px 24px rgba(15,23,42,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
      margin-top: 10px;
    }

    h1, h2 { margin: 0 0 8px; }
    h1 { font-size: 22px; line-height: 1.25; }
    h2 { font-size: 20px; line-height: 1.3; }
    p  { font-size: 16px; line-height: 1.5; margin: 0; }

    label { font-size: 16px; display: block; margin-bottom: 6px; font-weight: 500; }

    input[type="text"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      padding: 11px 12px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(15,23,42,0.14);
      font-size: 16px;              /* ‚Üê ‚â•16 to avoid iOS zoom */
      outline: none;
      background-color: #fff;
      font-family: inherit;
    }
    textarea { resize: vertical; min-height: 90px; }

    input[type="radio"],
    input[type="checkbox"] { margin-right: 8px; }

    .options {
      display: grid;
      gap: 10px;
      margin-top: 6px;
      font-size: 16px;              /* labels next to radios/checkboxes */
    }
    .helper { font-size: 13px; color: rgba(15,23,42,0.6); margin-top: 2px; }

    .pill {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 4px 8px; border-radius: 999px;
      font-size: 12px; background: rgba(46,125,124,0.08); color: var(--teal);
      margin-bottom: 2px;
    }

    .btn-row { display: flex; justify-content: space-between; gap: 8px; margin-top: 6px; }
    button {
      border: none; cursor: pointer; padding: 12px 16px;
      border-radius: var(--radius-lg); font-size: 16px; font-weight: 600;
      display: inline-flex; align-items: center; justify-content: center; gap: 6px;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
      -webkit-tap-highlight-color: transparent;
    }
    .btn-primary { background-color: var(--teal); color: #ffffff; flex: 1; box-shadow: 0 4px 12px rgba(46,125,124,0.18); }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(46,125,124,0.26); }
    .btn-ghost   { background-color: #ffffff; color: var(--ink); border: 1px solid rgba(15,23,42,0.18); flex-basis: 120px; }

    .status { font-size: 13px; margin-top: 2px; }
    .status.warn { color: #b45309; }
    .status.ok   { color: #15803d; }

    .result-score { font-size: 26px; font-weight: 700; margin: 4px 0; }
    .small-label  { font-size: 13px; color: rgba(15,23,42,0.65); margin-top: 4px; }
    a.share-link  { font-size: 14px; color: var(--teal); text-decoration: underline; word-break: break-all; }

    .match-row {
      display: grid; grid-template-columns: 1.2fr 1.8fr; gap: 8px; align-items: center; font-size: 16px;
    }

    /* CTA emphasis */
    .cta {
      margin-top: 8px;
      font-size: 16px;
      font-weight: 700;
      color: var(--teal);
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="logo">üß†</div>
    <div>
      <div class="brand-title">Neuro Niche</div>
      <div class="brand-sub">Neurodiversity in Schools ‚Äî Fundamentals</div>
    </div>
  </header>

  <div class="progress-wrap"><div id="progressBar" class="progress-bar"></div></div>
  <div id="card" class="card"></div>
</div>

<script>
  // Steps:
  // 0: Intro; 1‚Äì4: Questions; 5: Results + CTA; 6: Contact form
  const QUESTION_STEPS = 4;

  // Your deployed Google Apps Script Web App URL (must be the /exec URL)
  const LOG_ENDPOINT = ""; // e.g., "https://script.google.com/macros/s/XXXX/exec"

  let state = { step: 0, name: "", email: "", answers: {}, logged: false };

  const card = document.getElementById("card");
  const progressBar = document.getElementById("progressBar");

  function updateProgress() {
    if (state.step === 0) progressBar.style.width = "0%";
    else if (state.step >= 1 && state.step <= QUESTION_STEPS) {
      progressBar.style.width = (state.step / QUESTION_STEPS) * 100 + "%";
    } else progressBar.style.width = "100%";
  }

  function el(tag, attrs = {}, children = []) {
    const node = document.createElement(tag);
    Object.entries(attrs).forEach(([k, v]) => {
      if (k === "class") node.className = v;
      else if (k === "for") node.htmlFor = v;
      else if (k === "html") node.innerHTML = v;
      else node.setAttribute(k, v);
    });
    (Array.isArray(children) ? children : [children]).forEach(c => {
      if (c == null) return;
      if (typeof c === "string") node.appendChild(document.createTextNode(c));
      else node.appendChild(c);
    });
    return node;
  }

  function render() {
    card.innerHTML = "";
    updateProgress();
    switch (state.step) {
      case 0: return renderIntro();
      case 1: return renderQ1();
      case 2: return renderQ2();
      case 3: return renderQ3();
      case 4: return renderQ4();
      case 5: return renderResults();
      case 6: return renderContact();
    }
  }

  // --- 0) Intro ---
  function renderIntro() {
    card.appendChild(el("div", {class:"pill"}, "Mini lesson ¬∑ ~5 minutes"));
    card.appendChild(el("h1", {}, "Welcome to the mini lesson"));
    card.appendChild(el("p", {}, "This short lesson introduces key ideas about neurodiversity and neuro-inclusive practice in schools."));

    const nameLabel = el("label", {for:"name"}, "Your full name");
    const nameInput = el("input", {id:"name", type:"text", placeholder:"e.g., Sam Teacher", value: state.name});
    nameInput.addEventListener("input", e => { state.name = e.target.value; });

    const emailLabel = el("label", {for:"email"}, "Your email (for certificate / school log)");
    const emailInput = el("input", {id:"email", type:"email", placeholder:"you@school.org", value: state.email});
    emailInput.addEventListener("input", e => { state.email = e.target.value; });

    card.appendChild(nameLabel); card.appendChild(nameInput);
    card.appendChild(emailLabel); card.appendChild(emailInput);
    card.appendChild(el("div", {class:"helper"}, "Use your school email if you‚Äôd like your completion to be recognised."));

    const status = el("div", {class:"status"}, ""); card.appendChild(status);

    const btnRow = el("div", {class:"btn-row"});
    const startBtn = el("button", {class:"btn-primary"}, "Start lesson");
    startBtn.onclick = () => {
      if (!state.name || !state.email) {
        status.textContent = "Please enter your name and email to begin.";
        status.className = "status warn"; return;
      }
      status.textContent = ""; state.step = 1; render();
    };
    btnRow.appendChild(startBtn);
    card.appendChild(btnRow);
  }

  // --- 1) MCQ ---
  function renderQ1() {
    card.appendChild(el("div", {class:"pill"}, "Question 1 of 4 ¬∑ Multiple choice"));
    card.appendChild(el("h2", {}, "What does neurodiversity mean?"));
    card.appendChild(el("p", {}, "Choose the most accurate definition."));

    const opts = [
      "A medical disorder affecting a small number of people.",
      "The natural variation in human brains and minds across the population.",
      "A trend about productivity and self-optimization."
    ];

    const wrap = el("div", {class:"options"});
    const current = state.answers.q1 || "";
    opts.forEach((opt, i) => {
      const id = "q1_" + i;
      const input = el("input", {type:"radio", name:"q1", id, value: opt});
      if (current === opt) input.checked = true;
      input.addEventListener("change", () => { state.answers.q1 = opt; });
      const lbl = el("label", {for:id}, opt);
      wrap.appendChild(el("div", {}, [input, lbl]));
    });
    card.appendChild(wrap);

    const status = el("div", {class:"status"}, ""); card.appendChild(status);

    const btnRow = el("div", {class:"btn-row"});
    const back = el("button", {class:"btn-ghost"}, "Back");  back.onclick = () => { state.step = 0; render(); };
    const next = el("button", {class:"btn-primary"}, "Next");
    next.onclick = () => {
      if (!state.answers.q1) { status.textContent = "Please choose an answer."; status.className = "status warn"; return; }
      state.step = 2; render();
    };
    btnRow.appendChild(back); btnRow.appendChild(next); card.appendChild(btnRow);
  }

  // --- 2) Select all ---
  function renderQ2() {
    card.appendChild(el("div", {class:"pill"}, "Question 2 of 4 ¬∑ Select all that apply"));
    card.appendChild(el("h2", {}, "Which of the following are stereotypes or myths?"));
    card.appendChild(el("p", {}, "Tick every statement that reflects a harmful or incorrect assumption."));

    const opts = [
      "All neurodivergent students have the same needs.",
      "Neurodiversity is caused by poor parenting.",
      "You can reliably 'see' neurodiversity just by looking at someone.",
      "With the right supports and environment, many students can thrive."
    ];

    const selected = new Set(state.answers.q2 || []);
    const wrap = el("div", {class:"options"});
    opts.forEach((opt, i) => {
      const id = "q2_" + i;
      const input = el("input", {type:"checkbox", id, value: opt});
      if (selected.has(opt)) input.checked = true;
      input.addEventListener("change", () => {
        if (input.checked) selected.add(opt); else selected.delete(opt);
        state.answers.q2 = Array.from(selected);
      });
      const lbl = el("label", {for:id}, opt);
      wrap.appendChild(el("div", {}, [input, lbl]));
    });
    card.appendChild(wrap);

    card.appendChild(el("div", {class:"helper"}, "Hint: Look for generalisations, blame, or over-simplification."));

    const status = el("div", {class:"status"}, ""); card.appendChild(status);

    const btnRow = el("div", {class:"btn-row"});
    const back = el("button", {class:"btn-ghost"}, "Back"); back.onclick = () => { state.step = 1; render(); };
    const next = el("button", {class:"btn-primary"}, "Next");
    next.onclick = () => {
      const answers = state.answers.q2 || [];
      if (answers.length === 0) { status.textContent = "Select at least one option."; status.className = "status warn"; return; }
      state.step = 3; render();
    };
    btnRow.appendChild(back); btnRow.appendChild(next); card.appendChild(btnRow);
  }

  // --- 3) Select incorrect ---
  function renderQ3() {
    card.appendChild(el("div", {class:"pill"}, "Question 3 of 4 ¬∑ Select the incorrect answer"));
    card.appendChild(el("h2", {}, "Which statement does NOT describe neuro-inclusive practice?"));
    card.appendChild(el("p", {}, "Choose the option that conflicts with a neurodiversity-affirming approach."));

    const opts = [
      "Designing environments so that different sensory and learning profiles can succeed.",
      "Only supporting students after they 'fail' to cope with rigid expectations.",
      "Offering multiple ways to participate, communicate, and show understanding."
    ];

    const current = state.answers.q3 || "";
    const wrap = el("div", {class:"options"});
    opts.forEach((opt, i) => {
      const id = "q3_" + i;
      const input = el("input", {type:"radio", name:"q3", id, value: opt});
      if (current === opt) input.checked = true;
      input.addEventListener("change", () => { state.answers.q3 = opt; });
      const lbl = el("label", {for:id}, opt);
      wrap.appendChild(el("div", {}, [input, lbl]));
    });
    card.appendChild(wrap);

    const status = el("div", {class:"status"}, ""); card.appendChild(status);

    const btnRow = el("div", {class:"btn-row"});
    const back = el("button", {class:"btn-ghost"}, "Back"); back.onclick = () => { state.step = 2; render(); };
    const next = el("button", {class:"btn-primary"}, "Next");
    next.onclick = () => {
      if (!state.answers.q3) { status.textContent = "Please choose one answer."; status.className = "status warn"; return; }
      state.step = 4; render();
    };
    btnRow.appendChild(back); btnRow.appendChild(next); card.appendChild(btnRow);
  }

  // --- 4) Matching ---
  function renderQ4() {
    card.appendChild(el("div", {class:"pill"}, "Question 4 of 4 ¬∑ Matching"));
    card.appendChild(el("h2", {}, "Match each concept to the best description"));
    card.appendChild(el("p", {}, "Use the dropdowns to connect the idea with the most accurate phrase."));

    const options = [
      "Recognising natural brain/mind diversity across humans.",
      "An individual whose brain processes diverge from dominant expectations.",
      "Designing environments that expect variation and reduce barriers."
    ];

    const current = state.answers.q4 || {};
    const rows = [
      { key: "neurodiversity", label: "Neurodiversity" },
      { key: "neurodivergent", label: "Neurodivergent" },
      { key: "neuroinclusive", label: "Neuro-inclusive practice" }
    ];

    rows.forEach(row => {
      const sel = el("select", {});
      sel.appendChild(el("option", {value:""}, "-- Select a description --"));
      options.forEach(opt => {
        const o = el("option", {value:opt}, opt);
        if (current[row.key] === opt) o.selected = true;
        sel.appendChild(o);
      });
      sel.addEventListener("change", e => {
        if (!state.answers.q4) state.answers.q4 = {};
        state.answers.q4[row.key] = e.target.value;
      });

      const r = el("div", {class:"match-row"}, [ el("div", {}, row.label), sel ]);
      card.appendChild(r);
    });

    const status = el("div", {class:"status"}, ""); card.appendChild(status);

    const btnRow = el("div", {class:"btn-row"});
    const back   = el("button", {class:"btn-ghost"}, "Back"); back.onclick = () => { state.step = 3; render(); };
    const finish = el("button", {class:"btn-primary"}, "See my results");
    finish.onclick = () => {
      const q4 = state.answers.q4 || {};
      if (!q4.neurodiversity || !q4.neurodivergent || !q4.neuroinclusive) {
        status.textContent = "Please complete all three matches."; status.className = "status warn"; return;
      }
      calculateScore(); state.step = 5; render();
    };
    btnRow.appendChild(back); btnRow.appendChild(finish); card.appendChild(btnRow);
  }

  function calculateScore() {
    let score = 0;
    if (state.answers.q1 === "The natural variation in human brains and minds across the population.") score++;

    const correctMyths = new Set([
      "All neurodivergent students have the same needs.",
      "Neurodiversity is caused by poor parenting.",
      "You can reliably 'see' neurodiversity just by looking at someone."
    ]);
    const chosen = new Set(state.answers.q2 || []);
    if ([...correctMyths].every(m => chosen.has(m)) && [...chosen].every(m => correctMyths.has(m))) score++;

    if (state.answers.q3 === "Only supporting students after they 'fail' to cope with rigid expectations.") score++;

    const q4 = state.answers.q4 || {};
    const c1 = q4.neurodiversity === "Recognising natural brain/mind diversity across humans.";
    const c2 = q4.neurodivergent === "An individual whose brain processes diverge from dominant expectations.";
    const c3 = q4.neuroinclusive === "Designing environments that expect variation and reduce barriers.";
    if (c1 && c2 && c3) score++;

    state.answers.score = score;
    if (!state.logged) logCompletion(score);
  }

  // --- Google Sheets logging (uses no-cors; success is ‚Äúfire-and-forget‚Äù) ---
  function logCompletion(score) {
    if (!LOG_ENDPOINT) return;
    const payload = {
      type: "completion",
      name: state.name,
      email: state.email,
      score: score,
      completed_at: new Date().toISOString()
    };
    fetch(LOG_ENDPOINT, {
      method: "POST",
      mode: "no-cors",                            // avoids CORS errors in browser console
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    }).catch(() => {});
    state.logged = true;
  }

  function logContact(data) {
    if (!LOG_ENDPOINT) return;
    const payload = {
      type: "contact",
      name: data.name,
      email: data.email,
      message: data.message,
      submitted_at: new Date().toISOString()
    };
    fetch(LOG_ENDPOINT, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    }).catch(() => {});
  }

  // --- 5) Results + CTA ---
  function renderResults() {
    const score = state.answers.score || 0;
    const name = state.name || "there";

    card.appendChild(el("div", {class:"pill"}, "Completed"));
    card.appendChild(el("h2", {}, `Well done, ${name}!`));
    card.appendChild(el("p", {}, "You‚Äôve completed the Neurodiversity in Schools ‚Äî Fundamentals quiz."));
    card.appendChild(el("div", {class:"result-score"}, `${score} / 4`));

    let msg;
    if (score === 4) msg = "You‚Äôre demonstrating a strong, affirming understanding of core concepts.";
    else if (score === 3) msg = "Great foundations. A quick revisit of any missed items will deepen your confidence.";
    else msg = "This is a starting point. Consider revisiting the questions and reflecting with your team.";
    card.appendChild(el("p", {}, msg));

    card.appendChild(el("p", {class:"cta"}, "Are you an educator needing help designing environments that enable all to thrive?"));
    card.appendChild(el("p", {class:"cta"}, "Are you a parent or student needing support?"));

    const appUrl = encodeURIComponent(window.location.href.split("#")[0]);
    const shareText = encodeURIComponent("I just completed the Neurodiversity in Schools ‚Äì Fundamentals mini lesson with Neuro Niche. #Neurodiversity #NeuroInclusive #UDL");
    const linkedinUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${appUrl}&summary=${shareText}`;

    card.appendChild(el("p", {class:"small-label"}, "Optional: share your learning"));
    card.appendChild(el("a", {class:"share-link", href: linkedinUrl, target:"_blank", rel:"noopener noreferrer"}, "Share on LinkedIn"));

    const btnRow = el("div", {class:"btn-row"});
    const contactBtn = el("button", {class:"btn-primary"}, "Contact Neuro Niche");
    contactBtn.onclick = () => { state.step = 6; render(); };
    const restart = el("button", {class:"btn-ghost"}, "Restart lesson");
    restart.onclick = () => { state.step = 0; state.answers = {}; state.logged = false; render(); };
    btnRow.appendChild(contactBtn); btnRow.appendChild(restart); card.appendChild(btnRow);
  }

  // --- 6) Contact form ---
  function renderContact() {
    card.appendChild(el("div", {class:"pill"}, "Next step"));
    card.appendChild(el("h2", {}, "How can Neuro Niche support you?"));
    card.appendChild(el("p", {}, "Share a few details and we‚Äôll follow up with resources or a time to connect."));

    const nameLabel = el("label", {for:"c_name"}, "Name");
    const nameInput = el("input", {id:"c_name", type:"text", placeholder:"Your name", value: state.name});

    const emailLabel = el("label", {for:"c_email"}, "Email");
    const emailInput = el("input", {id:"c_email", type:"email", placeholder:"you@school.org", value: state.email});

    const descLabel = el("label", {for:"c_msg"}, "Short description of how Neuro Niche can help you");
    const descInput = el("textarea", {id:"c_msg", placeholder:"E.g., inclusive classroom design, guidance for a specific learner, or community resources."});

    card.appendChild(nameLabel);  card.appendChild(nameInput);
    card.appendChild(emailLabel); card.appendChild(emailInput);
    card.appendChild(descLabel);  card.appendChild(descInput);

    const status = el("div", {class:"status"}, ""); card.appendChild(status);

    const btnRow = el("div", {class:"btn-row"});
    const back   = el("button", {class:"btn-ghost"}, "Back"); back.onclick = () => { state.step = 5; render(); };
    const submit = el("button", {class:"btn-primary"}, "Send message");
    submit.onclick = () => {
      const n = nameInput.value.trim(), e = emailInput.value.trim(), m = descInput.value.trim();
      if (!n || !e || !m) { status.textContent = "Please fill in all fields before submitting."; status.className = "status warn"; return; }
      logContact({ name: n, email: e, message: m });
      status.textContent = "Thank you. Your message has been sent."; status.className = "status ok";
    };
    btnRow.appendChild(back); btnRow.appendChild(submit); card.appendChild(btnRow);
  }

  render();
</script>
</body>
</html>
